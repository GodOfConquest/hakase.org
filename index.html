<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">

<title>hakase.org</title>
<meta name="description" content="Because it's cute!">

<link rel="icon" href="favicon.ico">

<link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700' rel='stylesheet' type='text/css'>

<style>
  html {
    min-height: 100%;
    box-shadow: 0 0 150px #aaa inset; /* pleasant vingette */
    background-image: url("data:image/png;base64,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");
  }

  html, body, h1 { margin: 0; padding: 0; }

  body {
    font-family: 'Droid Serif', serif;
  }

  #title {
    font-weight: 700;
    font-size: 150px;
    text-align: center;

    color: white;
    text-shadow: 3px 3px 0 black, 0 0 100px #999, 10px 10px 15px #aaa;

    margin: auto;
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
    height: 150px;
  }

  #nav {
    margin: 0;
    padding: 0 5px 0 5px;

    position: absolute;
    top: 0;
    right: 0;

    background: #222;
    border-bottom-left-radius: 5px;

    text-align: right;

    z-index: 11;
  }

  #nav li {
    display: inline;
    margin: 0;
    padding: 0;
  }

  #nav a {
    display: inline-block;
    height: 100%;
    padding: 0.5em;
    margin: 0;

    color: #ccc;
    text-decoration: none;
    letter-spacing: 0.08em;
  }

  #nav a:hover {
    color: white;
  }

  #hakase {
    position: absolute;
    bottom: 0;
  }

  section {
    visibility: hidden;
    margin: auto;
    position: absolute;
    top: 0;
    bottom: 0;

    width: 100%;
    min-width: 320px;
    height: 50%;

    z-index: 100;


    opacity: 0;

    pointer-events: none;
  }

  section > div {
    pointer-events: all; /* let return click through the sides */

    margin: 0 auto;
    width: 50%;
    min-width: 320px;
    height: 100%;
    padding: 2em;

    box-sizing: border-box;
    -ms-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -o-box-sizing: border-box;

    overflow-y: auto;
    background-color: rgba(240, 240, 240, 0.98);
    box-shadow: 0 0 10px rgba(240, 240, 240, 0.98),
                0 0 15px rgba(240, 240, 240, 0.98),
                0 0 20px rgba(240, 240, 240, 0.98);
    border-radius: 10px;
  }

  #return {
    opacity: 0;

    visibility: hidden;
    display: block;
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;

    z-index: 10;
    background-color: rgba(0,0,0,0.15);
  }

  /* really clever way to click out of lightboxes, if I do say so myself */
  section:target, section:target ~ #return {
    visibility: visible;
    opacity: 1;
  }

  section, #return {
    transition: 1s;
    -moz-transition: 1s;
    -ms-transition: 1s;
    -webkit-transition: 1s;
    -o-transition: 1s;
  }

  p {
    line-height: 1.6em; /* TODO actual vertical rhythm */
  }
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>

<h1 id="title">hakase.org</h1>

<ul id="nav">
  <li><a href="#news">News</a></li><li><a href="#projects">Projects</a></li><li><a href="#about">About</a></li>
</ul>

<section id="news">
  <div>
    <h1>News</h1>
    <p>Expect cool things!
  </div>
</section>

<section id="projects">
  <div>
    <h1>Projects</h1>
    <p>Nothing yet!
  </div>
</section>

<section id="about">
  <div>
    <h1>About</h1>
    <p>A website, in your browser! How novel!
    <p><i>hakase.org</i> is designed and maintained by <a
        href="mailto:queue@lavabit.com">queue</a>. You can stare at this
      website's source code on <a
        href="https://github.com/qqueue/hakase.org">Github</a> if you want.
  </div>
</section>

<a id="return" href="#"></a>

<canvas id="hakase" height="119">hakase.org</canvas>

<script>
(function () {
"use strict";

// stretch title stuff
// adapted from https://github.com/davatron5000/FitText.js

function debounce(time, fn) {
  var timeout;
  return function () {
    var ctx = this, args = arguments;
    clearTimeout(timeout);
    timeout = setTimeout(function () {
      fn.apply(this, args);
    }, time);
  };
}

// behold my carefully tuned constants
function resize() {
  var h1 = document.getElementById('title');
  h1.style.fontSize = (window.innerWidth / 7) + 'px';
  h1.style.height = (window.innerWidth / 5) + 'px';
}

document.addEventListener('DOMContentLoaded', function () {
  resize();
  window.addEventListener('resize', debounce(300, resize));
});

// page visibility API polyfill
if (typeof document.hidden !== "undefined") {
  (function () {
    var hidden, visibilityChange;
    if (typeof document.mozHidden !== "undefined") {
      hidden = "mozHidden";
      visibilityChange = "mozvisibilitychange";
    } else if (typeof document.msHidden !== "undefined") {
      hidden = "msHidden";
      visibilityChange = "msvisibilitychange";
    } else if (typeof document.webkitHidden !== "undefined") {
      hidden = "webkitHidden";
      visibilityChange = "webkitvisibilitychange";
    }

    // set the real document.hidden property, and dispatch the polyfilled event
    document.addEventListener(visibilityChange, function () {
      document.hidden = document[hidden];
      document.dispatchEvent(new CustomEvent("visibilitychange"));
    });
  })();
}

// The parts of the animation overlap slightly, so this is the true width
// to shift the container by when moving
var TURN_WIDTH_LEFT = 55,
    TURN_WIDTH_RIGHT = 170,
    WALK_LEFT_START = 266,
    WALK_RIGHT_START = 150,
    WALK_WIDTH = {
      left: [-27, -32, -19, -22, -25],
      right: [27, 32, 19, 22, 25]
    };

document.addEventListener('DOMContentLoaded', function () {

  var hakase = document.getElementById('hakase'),
      ctx = hakase.getContext('2d'),

      // start animation after all the images load
      total_assets = 5 + 5 + 14 + 16,
      onload = function () {
        if (--total_assets == 0) { tick(); }
      },
      load = function (src) {
        var img = new Image;
        img.src = src;
        img.onload = onload;
        return img;
      },
      walk = {
        left: [
          "walk/left/0.png",
          "walk/left/1.png",
          "walk/left/2.png",
          "walk/left/3.png",
          "walk/left/4.png"
        ].map(load),
        right: [
          "walk/right/0.png",
          "walk/right/1.png",
          "walk/right/2.png",
          "walk/right/3.png",
          "walk/right/4.png"
        ].map(load)
      },
      turn = {
        left: [
          "turn/left/0.png",
          "turn/left/1.png",
          "turn/left/2.png",
          "turn/left/3.png",
          "turn/left/4.png",
          "turn/left/5.png",
          "turn/left/6.png",
          "turn/left/7.png",
          "turn/left/8.png",
          "turn/left/9.png",
          "turn/left/10.png",
          "turn/left/11.png",
          "turn/left/12.png",
          "turn/left/13.png"
        ].map(load),
        right: [
          "turn/right/0.png",
          "turn/right/1.png",
          "turn/right/2.png",
          "turn/right/3.png",
          "turn/right/4.png",
          "turn/right/5.png",
          "turn/right/6.png",
          "turn/right/7.png",
          "turn/right/8.png",
          "turn/right/9.png",
          "turn/right/10.png",
          "turn/right/11.png",
          "turn/right/12.png",
          "turn/right/13.png",
          "turn/right/14.png",
          "turn/right/15.png"
        ].map(load)
      },

      x         = -250, // cutely walk into the screen from stage left
      walking   = true,
      direction = "right",
      anim      = walk[direction],
      frames    = anim.length,
      frame     = 0,

      draw = function () {
        // resetting the canvas width has the added effect of clearing it
        hakase.width = window.innerWidth;

        // not all the images are the same height, and it's a goddamn hassle to
        // either figure out how to script them to the same height, or to do it
        // manually with GIMP's god-awful interface
        ctx.drawImage(anim[frame], x, 119 - anim[frame].height);
      };

  // animation loop
  function tick () {
    ++frame;

    if (walking) {
      frame = frame % frames;

      x += WALK_WIDTH[direction][frame];

      if ( direction === "right" && (window.innerWidth - x) < TURN_WIDTH_RIGHT ||
           direction === "left" && x < TURN_WIDTH_LEFT ) {

        walking = false;
        if (direction === "right") {
          direction = "left";
          x = window.innerWidth - 266; // width of actual turning anim
        } else { // left
          direction = "right";
          x = 0;
        }

        anim = turn[direction];
        frames = anim.length;
        frame = 0;
      }
    } else { // turning
      if (frame >= frames) {
        walking = true;
        anim = walk[direction];
        frames = anim.length;
        frame = 0;

        x = direction === "right" ?
          WALK_RIGHT_START :
          window.innerWidth - WALK_LEFT_START;
      }
    }

    draw();

    if (document.hidden) {
      // continue once we're no longer hidden
      document.addEventListener("visibilitychange", function restart () {
        setTimeout(tick, 120);
        document.removeEventListener("visibilitychange", restart);
      });
    } else {
      setTimeout(tick, 120);
    }
  }
});
})();
</script>

</body>
</html>
